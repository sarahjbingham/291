---
title: "Health Factors Related to Sleep"
author: "Lika Mikhelashvili, Kelly Ford, Sarah Bingham"
date: "12/5/2020"
output:
 html_document:
   code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      message = FALSE,
                      options(scipen=999))
```

```{r}
library(ipumsr)
library(ggplot2)
library(moderndive)
library(tidyverse)
library(car)
ddi <- read_ipums_ddi("nhis_00001.xml")
data <- read_ipums_micro(ddi)
```

```{r}
hellostats_data <- data %>%
  select(AGE, RACENEW, EARNIMP1, WEIGHT, ALCDAYSWK, HRSLEEP, SLEEPMEDS, DEPRX, PCUSEFREQ) %>%
  filter(ALCDAYSWK %in% c("10", "20", "30", "40", "50", "60", "70", "80"),
         HRSLEEP %in% 1:24,
         SLEEPMEDS %in% c("0", "1", "2", "3", "4", "5", "6", "7"),
         DEPRX %in% c("1", "2"),
         PCUSEFREQ %in% c("1", "2", "3", "4"),
         AGE != 0,
         RACENEW %in% c("10", "20", "30", "40", "50", "60"),
         !(WEIGHT %in% c("996","997", "999"))) %>% 
  mutate(PCUSEFREQ = dplyr::recode(as.integer(PCUSEFREQ), `1` = "Infrequent", `2` = "Infrequent", `3` = "Frequent", `4` = "Frequent"), 
         HRSLEEP = as.integer(HRSLEEP),
         DEPRX = dplyr::recode(as.integer(DEPRX), `1` = "No", `2` = "Yes"),
         SLEEPMEDS =as.integer(SLEEPMEDS),
         ALCDAYSWK = dplyr::recode(as.integer(ALCDAYSWK), `10`=1, `20`=2, `30`=3, `40`=4, `50`=5, `60`=6, `70`=7, `80`=8))
```

* Models  (I think we need to take out WEIGHT from the full model) *

```{r}
full_model <- lm(HRSLEEP ~ SLEEPMEDS + DEPRX + PCUSEFREQ + WEIGHT + ALCDAYSWK, data = hellostats_data)
get_regression_table(full_model)
get_regression_summaries(full_model)
vif(full_model)
                    
```

```{r}
alcohol_model <- lm(HRSLEEP ~ SLEEPMEDS + DEPRX + PCUSEFREQ + ALCDAYSWK, data = hellostats_data)
get_regression_summaries(alcohol_model)
get_regression_table(alcohol_model)
vif(alcohol_model)
```

Nested Model:

```{r}
anova(full_model, alcohol_model)
```



# Abstract

# Background and Significance

This project focuses on self-reported areas of mental and physical health among 72,831 randomly selected people living in the United States during the year of 2018. These spheres of health include whether or not one takes depression and/or sleep medication, hours of sleep per day, and amount of alcohol consumed per year. The goal of this project is to compare these variables to the frequency of computer use in order to more clearly visualize the effect screen time on health. This project is very relevant to life during the pandemic, where we depend on technology and computer use more than ever. With this increased screen use, however, we may see a decrease in mental and physical health based on limited in-person social interaction and necessary self-isolation from others. Our hope is that this project gives some insight into the health ramifications associated with computer usage within a large economically and racially diverse sample. 

# Methods

## Data

Our study utilizes data made available online to the public from IPUMS-NHIS (National Health Interview Survey). This data set contains information from 2018, the most recent year available. IPUMS-NHIS data is collected annually of approximately 100,000 individuals throughout 45,000 households in the United States. *Our specific data set was collected by obtaining a random sample of 72,831 people living in the U.S who self-reported hours of sleep per night, computer use frequency, alcohol consumption frequency, weight, and how many times within the last week they have taken sleep medication and depression medication.* Each observation represents a separate individual, though this does indicate some individuals cohabitate. Each household has its own serial ID to distinguish which data come from which household. As cohabitation does not violate independence, we will consider all of the data points in our analysis. We will analyze the individuals who have reported meaningful data for the variables we are considering in the model, which means that we will filter out individuals who "refused to answer a question," "did not know," etc. *The population that we intend to generalize to is any person living in the United States (roughly about 328 million people).*
 
## Variables

The self-reported variables in our analysis include the predictor variable of usual hours slept per day, as well as the following explanatory variables: computer use frequency, alcohol consumption frequency, weight, number of times within the last week they have taken sleep medication, and number of times within the last week they have taken depression medication. Our full model includes all of these explanatory variables, while our reduced model excludes the weight variable. 

Usual hours of sleep per day is simply the numerical values (1-24) indicating the number of hours that the individual sleeps on an average day. The values that we will filter out are 25 (less than one hour), 97 (refused to answer), 98 (not ascertained), and 99 (unsure). 

Let us look now at our explanatory variables. 

Numerical explanatory variables included sleep medication and weight. In terms of sleep medication, participants answered 0 if they didn't take medication to sleep in the past week, 01-06 for medication taken 1-6 times, and 07 for medication taken 7 or more times. We will filter out answers that are 96 (not applicable), 97 (refused to answer), 98 (not ascertained), and 99 (unsure). Weight tells us the participant's weight in pounds without including clothes or shoes. We will filter out 996 (refused to answer), 997 (not ascertained), and 998 (unknown).

Depression medication was a binary response variable which indicated "2" for taken depression medication in the past week, or "1" for has not taken depression medication in the past week. The variable is a categorical variable so we will transform 2 into "yes" and 1 into "no". We will filter out answers that are 0 (not applicable), 7 (refused to answer), 8 (not ascertained), and 9 (unsure). 

Computer use frequency gave participants the opportunity to give a categorical response of 1 (never or almost never), 2 (some days), 3 (most days), or 4 (every day). We will filter out answers that are 0 (not applicable), 7 (refused to answer), 8 (not ascertained), and 9 (unsure). After receiving this data, we mutated the answers in order to produce a binary response of "frequent" or "infrequent" computer use. We did this by combining responses of 1 and 2 and assigning these to the label "infrequent" and responses 3 and 4 become assigned to "frequent".   

## Analysis

# Results

# Discussion

## Visualizaions

```{r}
ggplot(hellostats_data, aes(x=ALCDAYSWK, y=HRSLEEP, color=SLEEPMEDS)) +
  geom_point() +
  geom_smooth(method = lm, se=FALSE, formula=y~x) +
  facet_grid(PCUSEFREQ ~ DEPRX)
```


```{r}
ggplot(hellostats_data, aes(x=ALCDAYSWK, y=HRSLEEP, color=SLEEPMEDS)) +
  geom_point() +
  geom_smooth(method = lm, se=FALSE, formula=y~x) +
  facet_wrap(~DEPRX)
```


## Limitations

The limitation of our analysis is the fact that the values in all variables are self-reported, which makes the data less accurate. Also, we were limited to IPUMS variables and the survey texts they used. For example, in case of `PCUSEFREQ` variable, instead of having the variable be categorical, it would be much more accurate to have numeric variable with the number of hours of computer usage. Due to less flexibility in the available variables, we cannot infer any causal relationship between the hours slept and computer/health medication usage.

## Conclusion


# Data Appendix

## Checking Regression Assumptions

### Linearity
### Randomness
### Independence

## Coefficient summary

## Collinearity testing (VIF) testing






